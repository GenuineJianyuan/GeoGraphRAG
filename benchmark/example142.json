{
    "query": "Landsat8 TOA影像全色锐化与合成",
    "datasource": [
        "Landsat8 TOA"
    ],
    "raw_code": "// Function to mask clouds using the quality band of Landsat 8.\nvar maskL8 = function(image) {\n  var qa = image.select('BQA');\n  /// Check that the cloud bit is off.\n  // See https://landsat.usgs.gov/collectionqualityband\n  var mask = qa.bitwiseAnd(1 << 4).eq(0);\n  return image.updateMask(mask);\n};\n\n// HSV-based Pan-Sharpening of Landsat 8 TOA images.\nvar panSharpenL8 = function(image) {\n  var rgb = image.select('B4', 'B3', 'B2');\n  var pan = image.select('B8');\n  // Convert to HSV, swap in the pan band, and convert back to RGB.\n  var huesat = rgb.rgbToHsv().select('hue', 'saturation');\n  var upres = ee.Image.cat(huesat, pan).hsvToRgb();\n  return image.addBands(upres);\n};\n\n// Map the function over one year of Landsat 8 TOA data and take the median.\nvar composite = ee.ImageCollection('LANDSAT/LC08/C01/T1_TOA')\n    .filterDate('2016-01-01', '2016-12-31')\n    .map(maskL8)\n    .map(panSharpenL8)\n    .median();\n\n// There are many fine places to look; here is one.  Comment\n// this out if you want to twiddle knobs while panning around.\nMap.setCenter(-59.61577, 6.80943, 15);\n\n// Display before and after layers using the same vis parameters.\nMap.addLayer(composite, {bands:['B4', 'B3', 'B2'], max: 0.3}, 'Original');\nMap.addLayer(composite, {bands:['red','green','blue'], max: 0.3}, 'Pansharpened')",
    "api": [
        "ee.Image.select",
        "ee.Image.bitwiseAnd",
        "ee.Image.eq",
        "ee.Image.updateMask",
        "ee.Image.rgbToHsv",
        "ee.Image.cat",
        "ee.Image.hsvToRgb",
        "ee.Image.addBands",
        "ee.ImageCollection.filterDate",
        "ee.ImageCollection.map",
        "ee.ImageCollection.median",
        "Map.setCenter",
        "Map.addLayer"
    ],
    "processing step": [
        "Mask clouds using Landsat 8 quality band.",
        "Select RGB bands for Pan-Sharpening.",
        "Convert RGB to HSV color space.",
        "Merge HSV with panchromatic band.",
        "Convert back to RGB color space.",
        "Apply Pan-Sharpening to Landsat 8 images.",
        "Compute median of processed images.",
        "Display original and Pan-Sharpened results."
    ],
    "output": "Pansharpened Landsat 8 imagery."
}